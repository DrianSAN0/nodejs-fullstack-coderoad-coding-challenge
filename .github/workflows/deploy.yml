name: Fullstack Deploy

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Install server dependencies
        run: |
          cd server
          npm install
          npm run build

      - name: Install client dependencies
        run: |
          cd client
          npm install
          npm run build

      - name: Deploy
        run: |
          echo "Starting deploy..."
          ./scripts/deploy.sh


#!/bin/bash
LOGFILE="/var/log/deploy_site.log"
DATE=$(date '+%Y-%m-%d %H:%M:%S')

echo "[$DATE] Deploy started" >> $LOGFILE

# Copiar backend compilado
cp -r server/dist/* /var/www/html/server/

# Copiar frontend construido
cp -r client/build/* /var/www/html/client/

echo "[$DATE] Deploy finished successfully" >> $LOGFILE
